steps:
  # check if we want to rebuild
  - name: bash
    args:
      - ./verify-should-rebuild-image.sh
  # build the image
  - name: gcr.io/cloud-builders/docker
    args:
      - build
      - --tag
      - gcr.io/$PROJECT_ID/sweetspot-build:$SHORT_SHA
      - --file
      - Dockerfile.base
      - .
  # push the container image to Container Registry
  - name: gcr.io/cloud-builders/docker
    args:
      - push
      - gcr.io/$PROJECT_ID/sweetspot-build:$SHORT_SHA
images:
  - gcr.io/$PROJECT_ID/sweetspot-build:$SHORT_SHA
timeout: 1800s
options:
  machineType: N1_HIGHCPU_8
