#!/bin/bash

print_filesize() {
  FILE_SIZE=$(du -k ../dist/$1 | cut -f1)
  echo "${FILE_SIZE}K -- $2"
}

echo "ðŸš€ Building PureScript Injectable"
START=$(date +%s)
pulp build --to ../dist/injectable.js
if [ $? -ne 0 ]; then
    exit 1
fi
npx --quiet uglify-js --compress --mangle --output ../dist/injectable.min.js -- ../dist/injectable.js
if [ $? -ne 0 ]; then
    exit 1
fi
gzip --keep --force ../dist/injectable.min.js
if [ $? -ne 0 ]; then
    exit 1
fi
END=$(date +%s)
BUILD_TIME=$(( $END - $START ))
echo "ðŸ‘Œ Finished build in ${BUILD_TIME}s"
echo "ðŸ—œ Build size:"
print_filesize "injectable.js" "Raw Output"
print_filesize "injectable.min.js" "Minified"
print_filesize "injectable.min.js.gz" "Minified and Compressed"
